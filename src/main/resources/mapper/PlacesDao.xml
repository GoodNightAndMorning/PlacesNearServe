<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zsx.pn.dao.PlacesDao">
    <delete id="deletePlaces">
        delete from places_tb where id = #{id}
    </delete>
    <update id="updatePlaces" parameterType="com.zsx.pn.entity.Places">
        update places_tb set tag_id = #{tagId},
                             place_name = #{placeName},
                             place_phone = #{placePhone},
                             place_desc = #{placeDesc},
                             place_photos = #{placePhotos},
                             longitude = #{longitude},
                             latitude = #{latitude},
                             state = #{state}
                          where id = #{id}
    </update>

    <update id="updatePlacesOfState">
        update places_tb set state = #{state} where id = #{id}
    </update>
    <insert id="insertPlaces" parameterType="com.zsx.pn.entity.Places">
        insert into user_tb(tag_id,place_name,place_phone,place_desc,place_photos,longitude,latitude,creator_id)
               values (#{tagId},#{placeName},#{placePhone},#{placeDesc},#{placePhotos},#{longitude},#{latitude},#{creatorId})
    </insert>

    <select id="queryPlacesList" resultMap="placesMap">
        select * from places_tb
    </select>
    <select id="queryPlacesListByState" resultMap="placesMap">
        select * from places_tb where state = #{state}
    </select>
    <select id="queryPlaceById" resultMap="placesMap">
        select * from places_tb where id = #{id}
    </select>

    <resultMap id="placesMap" type="Places">
        <id column="id" property="id"/>
        <result column="tag_id" property="tagId"/>
        <result column="place_name" property="placeName"/>
        <result column="place_phone" property="placePhone"/>
        <result column="place_desc" property="placeDesc"/>
        <result column="place_photos" property="placePhotos"/>
        <result column="longitude" property="longitude"/>
        <result column="latitude" property="latitude"/>
        <result column="creator_id" property="creatorId"/>
        <result column="create_time" property="createTime"/>
        <result column="state" property="state"/>
        <association property="tags" select="com.zsx.pn.dao.TagsDao.queryTagsById" column="tag_id"></association>
        <association property="user" select="com.zsx.pn.dao.UserDao.queryUserById" column="creator_id"></association>
    </resultMap>

</mapper>